<html>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/85/three.min.js"></script>
    <!-- <img src="http://localhost:8080/get_image"></img> -->
    <canvas id="2d" width="512" height="512" style="display: none"></canvas>

    <canvas id="3d" width="1000px" height="800px"></canvas>
    <script>
    import THREE from 'three'

    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('3d') })
    let scene, camera

    const canvas2d = document.getElementById('2d')
    const ctx = canvas2d.getContext("2d")

    const img = new Image()
    img.crossOrigin = 'anonymous'
    img.src = 'http://localhost:8080'

    const map = new THREE.Texture(canvas2d)
    const material = new THREE.MeshBasicMaterial({ map: map })

    const init = () => {
        scene = new THREE.Scene()

        camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 1, 10000)
        camera.position.set(0, 0, 5)
        scene.add(camera)

        const geometry = new THREE.TorusGeometry(1, 0.5, 16, 16)
        const mesh = new THREE.Mesh(geometry, material)
        scene.add(mesh)
    }

    const animate = () => {
        requestAnimationFrame(animate)

        // Update texture 
        ctx.drawImage(img, 0, 0, 500, 500)
        map.needsUpdate = true

        renderer.render(scene, camera)
    }

    init()
    animate()
    </script>
</body>
</html>